Rapid Device Support Development Using Hardware Abstraction Server and P4P

Andrei Sukhanov, BNL.

Development of device support for EPICS software infrastructure is challenging process, it requires in-depth knowledge of EPICS device drivers, database records, IOC toolchain and EPICS GUI. Due to complexity of the EPICS PVA protocol, implementation of the IOC on embedded hardware is practically impossible, especially for multi-client applications. To simplify this task a simple hardware abstraction server (HABS) have been developed. The HABS is small set of C/C++ functions which allows to convert user code to a point-to-point server. The server represent key device parameters as process variables. It serves get(), set() and info() requests and streams continuous measurements to a client. The data format of client-server communication is CBOR (a binary JSON model). Multiple requests can be executed during single transaction. The HABS' client is  p4p-based softIocPVA, it generates EPICS IOC automatically, obtaining all necessary information from the info() request. The server and softIocPVA can run on the same host, in that case the standard Linux IPC client-server protocol is used; or the server could be embedded inside the device firmware, communicating with softIocPVA using RS232 or TCP-IP.
This approach have been implemented in a testbench for ALS-U magnet power supplies and for multi-channel Analog/Digital signal processing unit, based on STM32G431 micro-controller.
